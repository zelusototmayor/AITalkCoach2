<aside class="app-sidebar" role="navigation" aria-label="Main sidebar navigation">
  <!-- Logo/Branding -->
  <div class="sidebar-header">
    <%= link_to practice_path, class: "sidebar-logo" do %>
      <img src="/icon.png" alt="" class="sidebar-logo-img" />
      <span class="sidebar-logo-text">AI Talk Coach</span>
    <% end %>
  </div>

  <!-- Navigation Links -->
  <nav class="sidebar-nav">
    <ul class="sidebar-nav-list">
      <li class="sidebar-nav-item">
        <%= link_to practice_path,
              class: "sidebar-nav-link #{'active' if current_page?(practice_path) || current_page?(app_root_path)}",
              aria: { current: (current_page?(practice_path) ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v3"/>
          </svg>
          <span class="sidebar-nav-text">Practice</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item">
        <%= link_to progress_path,
              class: "sidebar-nav-link #{'active' if current_page?(progress_path)}",
              aria: { current: (current_page?(progress_path) ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
          </svg>
          <span class="sidebar-nav-text">Progress</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item">
        <%= link_to history_sessions_path,
              class: "sidebar-nav-link #{'active' if current_page?(history_sessions_path)}",
              aria: { current: (current_page?(history_sessions_path) ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
          <span class="sidebar-nav-text">Reports</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item">
        <%= link_to '/prompts',
              class: "sidebar-nav-link #{'active' if request.path == '/prompts'}",
              aria: { current: (request.path == '/prompts' ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          <span class="sidebar-nav-text">Prompts</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item">
        <%= link_to '/privacy_settings',
              class: "sidebar-nav-link #{'active' if request.path == '/privacy_settings'}",
              aria: { current: (request.path == '/privacy_settings' ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
          <span class="sidebar-nav-text">Privacy</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item">
        <%= link_to subscription_path,
              class: "sidebar-nav-link #{'active' if current_page?(subscription_path)}",
              aria: { current: (current_page?(subscription_path) ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
            <line x1="1" y1="10" x2="23" y2="10"/>
          </svg>
          <span class="sidebar-nav-text">Billing</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item">
        <%= link_to settings_path,
              class: "sidebar-nav-link #{'active' if current_page?(settings_path)}",
              aria: { current: (current_page?(settings_path) ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/>
          </svg>
          <span class="sidebar-nav-text">Settings</span>
        <% end %>
      </li>
    </ul>
  </nav>

  <!-- User Profile Section -->
  <div class="sidebar-footer">
    <!-- Subscription Status Badge -->
    <% if current_user.subscription_lifetime? %>
      <div class="sidebar-subscription-badge" style="padding: 12px; background: linear-gradient(135deg, #F0F9FF, #E0F2FE); border-radius: 8px; margin-bottom: 12px; text-align: center; border: 1px solid #BAE6FD;">
        <div style="font-size: 11px; font-weight: 600; color: #0369A1; margin-bottom: 2px;">
          ‚ú® LIFETIME ACCESS
        </div>
        <div style="font-size: 9px; color: #64748B;">
          Unlimited forever
        </div>
      </div>
    <% elsif current_user.subscription_active? %>
      <div class="sidebar-subscription-badge" style="padding: 12px; background: linear-gradient(135deg, #F0FDF4, #DCFCE7); border-radius: 8px; margin-bottom: 12px; text-align: center; border: 1px solid #BBF7D0;">
        <div style="font-size: 11px; font-weight: 600; color: #15803D; margin-bottom: 2px;">
          <%= current_user.subscription_plan&.upcase %> PLAN
        </div>
        <% if current_user.current_period_end %>
          <div style="font-size: 9px; color: #64748B;">
            Renews <%= current_user.current_period_end.strftime('%b %d, %Y') %>
          </div>
        <% end %>
        <%= link_to 'Manage', subscription_path, style: 'display: block; margin-top: 6px; padding: 4px 8px; background: white; color: #15803D; text-decoration: none; border-radius: 4px; font-size: 10px; font-weight: 600; border: 1px solid #BBF7D0;' %>
      </div>
    <% elsif current_user.subscription_past_due? %>
      <div class="sidebar-subscription-badge" style="padding: 12px; background: linear-gradient(135deg, #FEF2F2, #FEE2E2); border-radius: 8px; margin-bottom: 12px; text-align: center; border: 1px solid #FECACA;">
        <div style="font-size: 11px; font-weight: 600; color: #DC2626; margin-bottom: 2px;">
          ‚ö†Ô∏è PAYMENT FAILED
        </div>
        <div style="font-size: 9px; color: #64748B;">
          Update payment method
        </div>
        <%= link_to 'Update', subscription_path, style: 'display: block; margin-top: 6px; padding: 4px 8px; background: white; color: #DC2626; text-decoration: none; border-radius: 4px; font-size: 10px; font-weight: 600; border: 1px solid #FECACA;' %>
      </div>
    <% elsif current_user.trial_active? %>
      <div class="sidebar-trial-banner" style="padding: 12px; background: linear-gradient(135deg, #FFF5F0, #FFEFE6); border-radius: 8px; margin-bottom: 12px; text-align: center;">
        <% if current_user.practiced_today? %>
          <div style="font-size: 11px; font-weight: 600; color: #10b981; margin-bottom: 4px;">
            ‚úÖ TODAY'S PRACTICE DONE!
          </div>
          <div style="font-size: 9px; color: var(--muted); line-height: 1.4;">
            Free access until <%= Date.tomorrow.end_of_day.strftime('%b %d, %I:%M %p') %>
          </div>
        <% else %>
          <div style="font-size: 11px; font-weight: 600; color: var(--brand-500); margin-bottom: 4px;">
            üéØ PRACTICE = FREE FOREVER
          </div>
          <div style="font-size: 9px; color: var(--muted); line-height: 1.4; margin-bottom: 6px;">
            Complete 1+ min session today ‚Üí Free tomorrow too!
          </div>
          <div style="font-size: 10px; color: var(--muted);">
            Trial expires in <%= current_user.trial_hours_remaining %>h
          </div>
        <% end %>
        <%= link_to 'View Plans', pricing_url, style: 'display: block; margin-top: 8px; padding: 6px 12px; background: white; color: var(--brand-500); text-decoration: none; border-radius: 6px; font-size: 11px; font-weight: 600; border: 1px solid var(--brand-500);' %>
      </div>
    <% else %>
      <div class="sidebar-subscription-badge" style="padding: 12px; background: linear-gradient(135deg, #FEF2F2, #FEE2E2); border-radius: 8px; margin-bottom: 12px; text-align: center; border: 1px solid #FECACA;">
        <div style="font-size: 11px; font-weight: 600; color: #DC2626; margin-bottom: 2px;">
          NO SUBSCRIPTION
        </div>
        <%= link_to 'Subscribe', pricing_url, style: 'display: block; margin-top: 6px; padding: 6px 12px; background: var(--gradient-primary); color: white; text-decoration: none; border-radius: 6px; font-size: 11px; font-weight: 600;' %>
      </div>
    <% end %>

    <div class="sidebar-user">
      <div class="sidebar-user-avatar">
        <%= current_user.name.first.upcase %>
      </div>
      <div class="sidebar-user-info">
        <div class="sidebar-user-name"><%= current_user.name %></div>
        <%= button_to app_subdomain_url('/logout'), method: :delete, class: "sidebar-logout-link", form: { style: "display: inline;" } do %>
          <span class="sidebar-logout-icon">‚Üó</span>
          <span>Logout</span>
        <% end %>
      </div>
    </div>
  </div>
</aside>
