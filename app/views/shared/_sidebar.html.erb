<aside class="app-sidebar" role="navigation" aria-label="Main sidebar navigation" data-sidebar-target="sidebar">
  <!-- Logo/Branding -->
  <div class="sidebar-header">
    <%= link_to practice_path, class: "sidebar-logo" do %>
      <img src="/icon.png" alt="" class="sidebar-logo-img" />
      <span class="sidebar-logo-text">AI Talk Coach</span>
    <% end %>
  </div>

  <!-- Navigation Links -->
  <nav class="sidebar-nav" data-tour="sidebar">
    <ul class="sidebar-nav-list">
      <li class="sidebar-nav-item">
        <%= link_to practice_path,
              class: "sidebar-nav-link #{'active' if current_page?(practice_path) || current_page?(app_root_path)}",
              aria: { current: (current_page?(practice_path) ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v3"/>
          </svg>
          <span class="sidebar-nav-text">Practice</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item">
        <%= link_to coach_path,
              class: "sidebar-nav-link #{'active' if current_page?(coach_path)}",
              aria: { current: (current_page?(coach_path) ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="8.5" cy="7" r="4"/>
            <polyline points="17 11 19 13 23 9"/>
          </svg>
          <span class="sidebar-nav-text">Coach</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item">
        <%= link_to progress_path,
              class: "sidebar-nav-link #{'active' if current_page?(progress_path)}",
              aria: { current: (current_page?(progress_path) ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
          </svg>
          <span class="sidebar-nav-text">Progress</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item">
        <%= link_to history_sessions_path,
              class: "sidebar-nav-link #{'active' if current_page?(history_sessions_path)}",
              aria: { current: (current_page?(history_sessions_path) ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
          <span class="sidebar-nav-text">Reports</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item">
        <%= link_to '/prompts',
              class: "sidebar-nav-link #{'active' if request.path == '/prompts'}",
              aria: { current: (request.path == '/prompts' ? "page" : nil) } do %>
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          <span class="sidebar-nav-text">Prompts</span>
        <% end %>
      </li>

      <li class="sidebar-nav-item sidebar-nav-dropdown" data-controller="dropdown">
        <button type="button"
                class="sidebar-nav-link sidebar-nav-dropdown-toggle <%= 'active' if ['/privacy_settings', subscription_path, settings_path].any? { |path| request.path == path || current_page?(path) } %>"
                data-action="click->dropdown#toggle"
                aria-expanded="false"
                data-dropdown-target="button">
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
          <span class="sidebar-nav-text">Profile</span>
          <svg class="sidebar-dropdown-arrow" data-dropdown-target="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>
        <ul class="sidebar-dropdown-menu" data-dropdown-target="menu" style="display: none;">
          <li>
            <%= link_to '/privacy_settings',
                  class: "sidebar-dropdown-link #{'active' if request.path == '/privacy_settings'}",
                  aria: { current: (request.path == '/privacy_settings' ? "page" : nil) } do %>
              <svg class="sidebar-dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
              <span>Privacy</span>
            <% end %>
          </li>
          <li>
            <%= link_to subscription_path,
                  class: "sidebar-dropdown-link #{'active' if current_page?(subscription_path)}",
                  aria: { current: (current_page?(subscription_path) ? "page" : nil) } do %>
              <svg class="sidebar-dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                <line x1="1" y1="10" x2="23" y2="10"/>
              </svg>
              <span>Billing</span>
            <% end %>
          </li>
          <li>
            <%= link_to settings_path,
                  class: "sidebar-dropdown-link #{'active' if current_page?(settings_path)}",
                  aria: { current: (current_page?(settings_path) ? "page" : nil) } do %>
              <svg class="sidebar-dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/>
              </svg>
              <span>Settings</span>
            <% end %>
          </li>
        </ul>
      </li>
    </ul>
  </nav>

  <!-- User Profile Section -->
  <div class="sidebar-footer">
    <!-- Subscription Status Badge -->
    <% if current_user.subscription_lifetime? %>
      <div class="sidebar-badge sidebar-badge-lifetime">
        <div class="sidebar-badge-title">‚ú® Lifetime Access</div>
        <div class="sidebar-badge-subtitle">Unlimited forever</div>
      </div>
    <% elsif current_user.subscription_active? %>
      <div class="sidebar-badge sidebar-badge-active">
        <div class="sidebar-badge-title"><%= current_user.subscription_plan&.capitalize %> Plan</div>
        <% if current_user.current_period_end %>
          <div class="sidebar-badge-subtitle">
            Renews <%= current_user.current_period_end.strftime('%b %d, %Y') %>
          </div>
        <% end %>
        <%= link_to 'Manage', subscription_path, class: 'sidebar-badge-link' %>
      </div>
    <% elsif current_user.subscription_past_due? %>
      <div class="sidebar-badge sidebar-badge-past-due">
        <div class="sidebar-badge-title">‚ö†Ô∏è Payment Failed</div>
        <div class="sidebar-badge-subtitle">Update payment method</div>
        <%= link_to 'Update', subscription_path, class: 'sidebar-badge-link' %>
      </div>
    <% elsif current_user.trial_active? %>
      <div class="sidebar-badge sidebar-badge-trial <%= 'practiced' if current_user.practiced_today? %>">
        <% if current_user.practiced_today? %>
          <div class="sidebar-badge-title">‚úÖ Today's Practice Done!</div>
          <div class="sidebar-badge-subtitle">
            Free for <%= current_user.trial_hours_remaining %>h - practice again to refresh!
          </div>
        <% else %>
          <div class="sidebar-badge-title">üéØ Practice = Free Forever</div>
          <div class="sidebar-badge-subtitle">
            Complete 1+ min session ‚Üí Free for 24h!
          </div>
          <div class="sidebar-badge-expiry">
            Trial expires in <%= current_user.trial_hours_remaining %>h
          </div>
        <% end %>
        <%= link_to 'View Plans', pricing_url, class: 'sidebar-badge-link' %>
      </div>
    <% else %>
      <div class="sidebar-badge sidebar-badge-none">
        <div class="sidebar-badge-title">No Subscription</div>
        <%= link_to 'Subscribe', pricing_url, class: 'sidebar-badge-link' %>
      </div>
    <% end %>

    <div class="sidebar-user">
      <div class="sidebar-user-avatar">
        <%= current_user.name.first.upcase %>
      </div>
      <div class="sidebar-user-info">
        <div class="sidebar-user-name"><%= current_user.name %></div>
        <%= link_to logout_path, class: "sidebar-logout-link", data: { turbo: false } do %>
          <span class="sidebar-logout-icon">‚Üó</span>
          <span>Logout</span>
        <% end %>
      </div>
    </div>
  </div>
</aside>
