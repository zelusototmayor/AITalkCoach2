<% content_for :title, trial_mode? ? "30s Demo - AI Talk Coach" : "Practice" %>

<div class="practice-interface <%= 'trial-mode' if trial_mode? %>"
     data-controller="recorder prompts insights practice-timer"
     <% unless trial_mode? %>data-action="analytics#handleRealSessionStart"<% end %>
     data-recorder-audio-only-value="true"
     data-recorder-max-duration-sec-value="<%= trial_mode? ? 30 : 180 %>"
     data-practice-timer-default-duration-value="<%= trial_mode? ? 30 : 60 %>">

  <div class="practice-layout">
    <!-- Left Panel - Practice Interface -->
    <div class="practice-panel">
      <div class="practice-header">
        <% if trial_mode? %>
          <div class="trial-header">
            <h2>30s Demo Session</h2>
            <div class="trial-badge">Free Trial</div>
          </div>
        <% else %>
          <h2>Practice Session</h2>
        <% end %>
      </div>

      <!-- Current Prompt Display - Library Style -->
      <div class="prompt-card practice-prompt-card" data-prompts-target="display" data-prompt-identifier="<%= @default_prompt_data[:identifier] %>">
        <div class="prompt-header">
          <!-- Title and Badges Row -->
          <div class="prompt-title-row">
            <h3 class="prompt-title-practice" data-prompts-target="title"><%= @default_prompt_data[:title] || "Practice Prompt" %></h3>
            <div class="prompt-badges-practice">
              <% if @default_prompt_data[:difficulty] %>
                <span class="difficulty-badge difficulty-<%= @default_prompt_data[:difficulty].downcase %>">
                  <%= @default_prompt_data[:difficulty].capitalize %>
                </span>
              <% end %>
            </div>
          </div>

          <!-- Description (optional, if exists) -->
          <% if @default_prompt_data[:description].present? %>
            <p class="prompt-description-practice"><%= @default_prompt_data[:description] %></p>
          <% end %>
        </div>

        <!-- Full Prompt Text -->
        <div class="prompt-text-practice" data-prompts-target="content">
          <% if params[:drill_title].present? %>
            <%= params[:drill_title] %>
          <% else %>
            <%= @default_prompt %>
          <% end %>
        </div>

        <!-- Footer -->
        <div class="prompt-footer-practice">
          <div class="prompt-footer-left">
            <span class="duration-icon">⏱</span>
            <span class="duration-text" data-prompts-target="targetTime">
              <%= distance_of_time_in_words(@default_prompt_data[:duration] || params[:target_seconds] || 60) %>
            </span>
          </div>

          <div class="prompt-footer-right">
            <% unless trial_mode? %>
              <button type="button" class="shuffle-btn-icon"
                      data-action="click->prompts#shufflePrompt"
                      title="Shuffle to a random prompt">
                <%= icon_svg(:shuffle, css_class: 'icon-sm') %>
              </button>
            <% end %>
          </div>
        </div>

        <!-- Hidden field to store prompt identifier for completion tracking -->
        <input type="hidden" name="session[prompt_identifier]" value="<%= @default_prompt_data[:identifier] %>" data-recorder-target="promptIdentifier">
      </div>

      <!-- Timer Controls - Compact Layout -->
      <div class="timer-controls-compact">
        <div class="timer-header">
          <h5>Duration</h5>
          <% if trial_mode? %>
            <div class="preset-buttons-horizontal">
              <button type="button" class="preset-btn active trial-locked"
                      data-duration="30">30s</button>
              <button type="button" class="preset-btn locked"
                      disabled
                      title="Sign up to unlock">60s <%= icon_svg(:lock, css_class: 'icon-inline') %></button>
              <button type="button" class="preset-btn locked"
                      disabled
                      title="Sign up to unlock">120s <%= icon_svg(:lock, css_class: 'icon-inline') %></button>
              <button type="button" class="preset-btn locked"
                      disabled
                      title="Sign up to unlock">180s <%= icon_svg(:lock, css_class: 'icon-inline') %></button>
            </div>
          <% else %>
            <% target_duration = (params[:target_seconds] || 60).to_i %>
            <div class="preset-buttons-horizontal">
              <button type="button" class="preset-btn <%= 'active' if target_duration == 30 %>"
                      data-duration="30"
                      data-action="click->practice-timer#selectDuration">30s</button>
              <button type="button" class="preset-btn <%= 'active' if target_duration == 60 %>"
                      data-duration="60"
                      data-action="click->practice-timer#selectDuration">60s</button>
              <button type="button" class="preset-btn <%= 'active' if target_duration == 90 %>"
                      data-duration="90"
                      data-action="click->practice-timer#selectDuration">90s</button>
              <button type="button" class="preset-btn <%= 'active' if target_duration == 120 %>"
                      data-duration="120"
                      data-action="click->practice-timer#selectDuration">120s</button>
              <button type="button" class="preset-btn <%= 'active' if target_duration == 180 %>"
                      data-duration="180"
                      data-action="click->practice-timer#selectDuration">180s</button>
            </div>
          <% end %>
        </div>

        <div class="timer-start-layout">
          <button type="button" class="start-btn-compact"
                  data-practice-timer-target="startBtn"
                  data-action="click->practice-timer#startSession">
            <%= icon_svg(:play, css_class: 'icon-inline') %> Start <span data-practice-timer-target="durationText"><%= trial_mode? ? '30s' : '60s' %></span>
          </button>

          <button type="button" class="cancel-btn-compact"
                  data-practice-timer-target="cancelBtn"
                  data-action="click->practice-timer#cancelSession"
                  style="display: none;"
                  title="Cancel recording and start over">
            <%= icon_svg(:x_simple, css_class: 'icon-inline') %> Cancel
          </button>

          <div class="countdown-timer-compact" data-practice-timer-target="display">
            <div class="timer-circle-small">
              <svg class="timer-svg" viewBox="0 0 80 80">
                <circle class="timer-track" cx="40" cy="40" r="36"></circle>
                <circle class="timer-progress"
                        cx="40" cy="40" r="36"
                        data-practice-timer-target="progressCircle"></circle>
              </svg>
              <div class="timer-content">
                <div class="timer-percentage" data-practice-timer-target="percentage">0%</div>
                <div class="timer-status" data-practice-timer-target="status">Ready</div>
              </div>
            </div>
            <div class="timer-time" data-practice-timer-target="timeDisplay">0s / <%= trial_mode? ? '30s' : '60s' %></div>
          </div>
        </div>
      </div>

      <!-- Post-Recording Action Buttons (appears immediately after recording completes) -->
      <div class="post-recording-actions" data-recorder-target="postRecordingActions" style="display: none;">
        <div class="recording-info">
          <div class="recording-status">
            <span class="status-icon"><%= icon_svg(:check_circle, css_class: 'icon-inline') %></span>
            <span class="status-text">Recording Complete!</span>
          </div>
          <div class="recording-details">
            <span data-recorder-target="recordingDuration">Duration: --s</span>
            <span class="separator">•</span>
            <span data-recorder-target="recordingTarget">Target: <%= trial_mode? ? '30s' : '60s' %></span>
          </div>
        </div>
        <div class="action-buttons">
          <button type="button" class="btn btn-secondary btn-record-again"
                  data-action="click->recorder#retake">
            <%= icon_svg(:refresh, css_class: 'icon-inline') %> Record Again
          </button>
          <button type="button" class="btn btn-primary btn-analyze"
                  data-action="click->recorder#submitRecording">
            <%= icon_svg(:chart, css_class: 'icon-inline') %> Analyze Recording
          </button>
        </div>
      </div>

      <!-- Enforcement Notice -->
      <div class="enforcement-notice">
        <p><small>Minimum time is enforced. Stopping early will mark the session as incomplete.</small></p>
      </div>

      <!-- Streamlined Pre-Recording Setup -->
      <div class="pre-recording-setup-compact" data-practice-timer-target="setup">
        <div class="session-config-compact">
          <!-- Collapsible Session Info Dropdown -->
          <div class="session-info-dropdown">
            <div class="session-info-header" data-action="click->recorder#toggleSessionConfig">
              <span class="session-info-title">Session Info</span>
              <span class="config-toggle-icon">▼</span>
            </div>
            <div class="session-config-content" data-recorder-target="sessionConfig" style="display: none;">
              <div class="config-row">
                <div class="config-group">
                  <label class="config-label">Session Title</label>
                  <input type="text" class="config-input"
                         placeholder="e.g., Interview practice"
                         data-recorder-target="titleInput"
                         data-action="input->recorder#clearTitleError"
                         required>
                  <div class="field-error" data-recorder-target="titleError" style="display: none;"></div>
                </div>
              </div>
              <div class="config-row secondary-settings">
                <div class="config-group">
                  <label class="config-label">Language</label>
                  <select class="config-select" data-recorder-target="languageSelect">
                    <option value="en">English</option>
                    <option value="pt">Portuguese</option>
                    <option value="es">Spanish</option>
                  </select>
                </div>
                <div class="config-group">
                  <label class="config-label">Type</label>
                  <select class="config-select" data-recorder-target="mediaKindSelect">
                    <option value="audio">Audio</option>
                    <option value="video">Video</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Post-Recording Form (appears after recording) -->
      <div class="recording-preview" data-recorder-target="preview" style="display: none;">
        <h5>Recording Complete!</h5>
        <div class="completion-message">
          <p>Your recording is ready. Review the details below and submit when ready.</p>
        </div>
        <div class="session-details-form">
          <div class="form-group">
            <label class="form-label">Session Title *</label>
            <input type="text" class="form-input session-title-input"
                   placeholder="e.g., Presentation practice, Interview prep"
                   data-recorder-target="titleInputPreview"
                   data-action="input->recorder#clearTitleError"
                   readonly>
            <small class="field-help">Copied from your pre-recording setup</small>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Language</label>
              <select class="form-select" data-recorder-target="languageSelectPreview" disabled>
                <option value="en">English</option>
                <option value="pt">Portuguese</option>
                <option value="es">Spanish</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Recording Type</label>
              <select class="form-select" data-recorder-target="mediaKindSelectPreview" disabled>
                <option value="audio">Audio Only</option>
                <option value="video">Video</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Audio Preview -->
        <div class="audio-preview">
          <audio data-recorder-target="audioPreview" controls></audio>
        </div>

        <!-- Action Buttons -->
        <div class="preview-actions">
          <button type="button" class="btn btn-secondary btn-replay"
                  data-action="click->recorder#replayAudio">
            Replay
          </button>
          <button type="button" class="btn btn-primary btn-use-recording"
                  data-action="click->recorder#submitRecording">
            Upload & Analyze
          </button>
        </div>
      </div>

      <!-- Session Report (appears after completion) -->
      <div class="session-report" data-practice-timer-target="report" style="display: none;">
        <h5>Session Report</h5>
        <div class="report-content">
          <!-- Will be populated by JavaScript after session completion -->
        </div>
      </div>
    </div>

    <!-- Right Panel - Insights & Library -->
    <div class="insights-panel">
      <% if trial_mode? %>
        <!-- Trial Results Display -->
        <% if @trial_results %>
          <div class="trial-results-card">
            <h3><%= icon_svg(:target, css_class: 'icon-inline') %> Your 30s Demo Results</h3>
            <% if @trial_results[:demo_mode] %>
              <div class="demo-notice" style="background: #fef3c7; border: 1px solid #f59e0b; padding: 8px 12px; border-radius: 6px; margin-bottom: 16px; font-size: 14px;">
                <%= icon_svg(:file_text, css_class: 'icon-inline') %> Demo mode: Showing sample results. Configure speech analysis to get real results.
              </div>
            <% end %>
            <% if @trial_results[:success] %>
              <div class="trial-metrics">
                <div class="trial-metric">
                  <div class="metric-label">WORDS PER MINUTE</div>
                  <div class="metric-value-large"><%= @trial_results[:wpm] %></div>
                </div>
                <div class="trial-metric">
                  <div class="metric-label">FILLER WORDS</div>
                  <div class="metric-value-large"><%= @trial_results[:filler_count] %></div>
                </div>
              </div>

              <div class="locked-features">
                <h4><%= icon_svg(:lock, css_class: 'icon-inline') %> Unlock with Full Account</h4>
                <div class="locked-feature">
                  <span class="feature-icon"><%= icon_svg(:chart, css_class: 'icon-inline') %></span>
                  <span>Clarity score analysis</span>
                </div>
                <div class="locked-feature">
                  <span class="feature-icon"><%= icon_svg(:trending_up, css_class: 'icon-inline') %></span>
                  <span>Progress tracking over time</span>
                </div>
                <div class="locked-feature">
                  <span class="feature-icon"><%= icon_svg(:lightbulb, css_class: 'icon-inline') %></span>
                  <span>Detailed coaching suggestions</span>
                </div>
                <div class="locked-feature">
                  <span class="feature-icon"><%= icon_svg(:clipboard, css_class: 'icon-inline') %></span>
                  <span>Session history & export</span>
                </div>
                <div class="locked-feature">
                  <span class="feature-icon"><%= icon_svg(:clock, css_class: 'icon-inline') %></span>
                  <span>Unlimited session lengths</span>
                </div>
              </div>

              <div class="trial-cta">
                <%= link_to app_subdomain_url('/signup'), class: "btn btn-primary btn-large trial-signup-btn" do %>
                  <span class="btn-icon"><%= icon_svg(:rocket, css_class: 'icon-inline') %></span>
                  Sign Up Free - Unlock Full Features
                <% end %>
              </div>
            <% else %>
              <div class="trial-error">
                <p><%= @trial_results[:error] %></p>
                <button type="button" class="btn btn-secondary" onclick="location.reload()">
                  Try Recording Again
                </button>
              </div>
            <% end %>
          </div>
        <% else %>
          <!-- Trial Introduction -->
          <div class="trial-intro-card">
            <h3><%= icon_svg(:lightning, css_class: 'icon-inline') %> 30s Demo</h3>
            <p>Try our AI speech coach with a quick 30-second demo. You'll get:</p>
            <ul class="demo-benefits">
              <li>Real-time speech analysis</li>
              <li>Words per minute calculation</li>
              <li>Filler word detection</li>
            </ul>
            <div class="upgrade-preview">
              <h4><%= icon_svg(:rocket, css_class: 'icon-inline') %> Full version includes:</h4>
              <div class="locked-feature"><%= icon_svg(:lock, css_class: 'icon-inline') %> Detailed clarity scoring</div>
              <div class="locked-feature"><%= icon_svg(:lock, css_class: 'icon-inline') %> Progress tracking</div>
              <div class="locked-feature"><%= icon_svg(:lock, css_class: 'icon-inline') %> Unlimited session lengths</div>
              <div class="locked-feature"><%= icon_svg(:lock, css_class: 'icon-inline') %> Personalized coaching</div>
              <div class="locked-feature"><%= icon_svg(:lock, css_class: 'icon-inline') %> Session history</div>
            </div>
          </div>
        <% end %>
      <% else %>
        <!-- Regular User Insights -->
        <% if @has_any_sessions %>
          <div class="insights-header-card">
            <h3><%= icon_svg(:activity, css_class: 'icon-inline') %> Insights</h3>
            <p class="insights-subtitle" style="font-size: 12px; color: #6b7280; margin: -8px 0 12px 0;">30-day averages</p>
            <div class="key-metrics-row">
              <div class="key-metric">
                <div class="metric-label">AVG WPM</div>
                <div class="metric-value-large">
                  <%= @quick_metrics[:avg_wpm] || 0 %>
                </div>
              </div>
              <div class="key-metric">
                <div class="metric-label">FILLER %</div>
                <div class="metric-value-large">
                  <%= @quick_metrics[:filler_rate] || 0 %>%
                </div>
              </div>
            </div>
            <div class="key-metrics-row secondary-row">
              <div class="key-metric">
                <div class="metric-label">CLARITY</div>
                <div class="metric-value-large">
                  <%= @quick_metrics[:clarity_score] || 0 %>
                </div>
              </div>
              <div class="key-metric">
                <div class="metric-label">STREAK</div>
                <div class="metric-value-large">
                  <%= @current_streak %> days
                </div>
              </div>
            </div>
          </div>
        <% else %>
          <!-- Empty State for New Users -->
          <div class="insights-header-card empty-state">
            <h3><%= icon_svg(:rocket, css_class: 'icon-inline') %> Ready to Get Started?</h3>
            <div style="padding: 24px 0; text-align: center;">
              <%= icon_svg(:microphone, css_class: 'icon-inline', style: 'width: 64px; height: 64px; opacity: 0.3; margin-bottom: 16px;') %>
              <p style="font-size: 16px; color: #6b7280; margin-bottom: 8px; line-height: 1.5;">
                Record your first session to see your<br>progress and personalized insights!
              </p>
              <p style="font-size: 14px; color: #9ca3af;">
                Your speaking metrics and coaching recommendations<br>will appear here after your first session.
              </p>
            </div>
          </div>
        <% end %>
      <% end %>

      <% unless trial_mode? %>
        <% if @has_any_sessions %>
          <!-- This Week's Goal -->
          <div class="weekly-goal-card-practice">
            <div class="card-header-compact">
              <div>
                <h3>This Week's Goal</h3>
                <span class="time-estimate">6–8 min/day</span>
              </div>
            </div>

            <% if @priority_recommendations&.dig(:focus_this_week)&.first %>
              <% focus_area = @priority_recommendations[:focus_this_week].first %>

              <h2 class="goal-title"><%= humanize_improvement_type(focus_area[:type]) %></h2>

              <div class="goal-narrative">
                <% if @weekly_focus_tracking %>
                  <%= generate_weekly_focus_narrative(focus_area, @weekly_focus_tracking) %>
                <% else %>
                  Target <%= format_metric_value(focus_area[:target_value], focus_area[:type]) %> by Sunday.
                  Average last 5 sessions: <%= format_metric_value(focus_area[:current_value], focus_area[:type]) %>.
                <% end %>
              </div>

              <div class="goal-progress">
                <div class="progress-stat">
                  <span class="stat-value"><%= @weekly_focus_tracking ? @weekly_focus_tracking[:sessions_today] : 0 %> / <%= @weekly_focus_tracking ? @weekly_focus_tracking[:target_today] : 2 %></span>
                  <span class="stat-label">Today</span>
                </div>
                <div class="progress-stat">
                  <span class="stat-value"><%= @weekly_focus_tracking ? @weekly_focus_tracking[:sessions_this_week] : 0 %> / <%= @weekly_focus_tracking ? @weekly_focus_tracking[:target_this_week] : 10 %></span>
                  <span class="stat-label">Week</span>
                </div>
                <div class="progress-stat">
                  <span class="stat-value"><%= @weekly_focus_tracking ? @weekly_focus_tracking[:streak_days] : 0 %></span>
                  <span class="stat-label">Streak</span>
                </div>
              </div>
            <% else %>
              <p class="goal-placeholder">Complete a few sessions to unlock your personalized weekly goal!</p>
            <% end %>
          </div>

          <!-- Detailed Performance Metrics -->
          <div class="performance-metrics-card">
            <h4>Performance Metrics</h4>
            <div class="metrics-grid-enhanced">
              <div class="metric-item">
                <div class="metric-label">Sessions</div>
                <div class="metric-value">
                  <%= @lifetime_session_count %>
                </div>
              </div>
              <div class="metric-item">
                <div class="metric-label">Total Time</div>
                <div class="metric-value">
                  <%= @lifetime_total_minutes %>m
                </div>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Prompt Library (Mobile-Inspired Design) -->
        <div class="prompt-library-practice" data-controller="prompts-practice">
          <div class="library-header">
            <h4>Prompt Library</h4>
            <p class="library-subtitle">Choose a prompt to start practicing</p>
          </div>

          <!-- Search and Filters -->
          <div class="library-controls">
            <div class="library-search">
              <input type="search"
                     placeholder="Search prompts..."
                     class="search-input-practice"
                     data-prompts-practice-target="searchInput"
                     data-action="input->prompts-practice#filterPrompts">
            </div>

            <div class="library-filters">
              <select class="filter-select-practice"
                      data-prompts-practice-target="difficultyFilter"
                      data-action="change->prompts-practice#filterPrompts">
                <option value="">All Levels</option>
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
              </select>

              <select class="filter-select-practice"
                      data-prompts-practice-target="categoryFilter"
                      data-action="change->prompts-practice#filterPrompts">
                <option value="">All Categories</option>
                <% @prompts.keys.sort.each do |category| %>
                  <option value="<%= category %>"><%= category.humanize %></option>
                <% end %>
              </select>
            </div>
          </div>

          <!-- Prompt Cards Grid -->
          <div class="library-prompts-grid">
            <%
              all_prompts = []
              @prompts.each do |category, prompts_list|
                next unless prompts_list.is_a?(Array)
                prompts_list.each_with_index do |prompt, index|
                  next unless prompt.is_a?(Hash)
                  all_prompts << { prompt: prompt, category: category, index: index }
                end
              end
              all_prompts.first(8).each do |item|
                prompt = item[:prompt]
                category = item[:category]
                index = item[:index]
            %>
              <div class="prompt-card-practice"
                   data-prompts-practice-target="card"
                   data-category="<%= category %>"
                   data-difficulty="<%= prompt['difficulty'] %>"
                   data-title="<%= prompt['title'] %>"
                   data-prompt-text="<%= prompt['prompt'] %>">

                <!-- Title and Badges Row -->
                <div class="prompt-title-row">
                  <h3 class="prompt-title-practice"><%= prompt['title'] %></h3>
                  <div class="prompt-badges-practice">
                    <span class="prompt-category">
                      <%= category.humanize %>
                    </span>
                    <% if prompt['difficulty'] %>
                      <span class="difficulty-badge difficulty-<%= prompt['difficulty'].downcase %>">
                        <%= prompt['difficulty'].capitalize %>
                      </span>
                    <% end %>
                  </div>
                </div>

                <!-- Description -->
                <p class="prompt-description-practice"><%= prompt['description'] %></p>

                <!-- Full Prompt Text -->
                <div class="prompt-text-practice">
                  <%= prompt['prompt'] %>
                </div>

                <!-- Footer -->
                <div class="prompt-footer-practice">
                  <div class="prompt-footer-left">
                    <span class="duration-icon">⏱</span>
                    <span class="duration-text"><%= distance_of_time_in_words(prompt['target_seconds']) %></span>
                  </div>

                  <div class="prompt-footer-right">
                    <button type="button"
                            class="btn btn-primary practice-btn-small"
                            data-action="click->prompts-practice#usePrompt"
                            data-prompt-id="<%= "#{category}_#{index}" %>"
                            data-prompt-text="<%= prompt['prompt'] %>"
                            data-target-seconds="<%= prompt['target_seconds'] %>">
                      Practice ›
                    </button>
                  </div>
                </div>
              </div>
            <% end %>
          </div>

          <div class="library-footer">
            <%= link_to "Browse All Prompts →", prompts_path, class: "browse-all-link" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Hidden form for session creation -->
  <%= form_with model: Session.new, local: true, multipart: true, class: "hidden-form",
        data: { practice_timer_target: "form" } do |f| %>
    <%= f.hidden_field :title, data: { practice_timer_target: "titleInput" }, value: params[:drill_title] %>
    <%= f.hidden_field :prompt_text, value: "" %>
    <%= f.hidden_field :language, value: "en" %>
    <%= f.hidden_field :media_kind, value: "audio" %>
    <%= f.hidden_field :target_seconds, data: { practice_timer_target: "durationInput" }, value: params[:target_seconds] %>
    <%= f.hidden_field :minimum_duration_enforced, value: "true" %>
    <%= f.hidden_field :weekly_focus_id, value: params[:weekly_focus_id] %>
    <%= f.hidden_field :is_planned_session, value: params[:is_planned_session] || "false" %>
    <%= f.hidden_field :planned_for_date, value: params[:is_planned_session] == "true" ? Date.current : nil %>
    <%= f.file_field :media_files, multiple: true,
          data: { recorder_target: "fileInput" }, style: "display: none;" %>
    <%= f.submit "Create Session", data: { practice_timer_target: "submitBtn" },
          style: "display: none;" %>
  <% end %>
</div>

<!-- Data for JavaScript controllers -->
<script type="application/json" id="prompts-data">
<%= raw @prompts.to_json %>
</script>

<script type="application/json" id="adaptive-prompts-data">
<%= raw @adaptive_prompts.to_json %>
</script>

<script type="application/json" id="categories-data">
<%= raw @categories.to_json %>
</script>

<style>
/* Cancel button styling */
.cancel-btn-compact {
  background: #ef4444;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-left: 8px;
}

.cancel-btn-compact:hover {
  background: #dc2626;
  transform: translateY(-1px);
}

.cancel-btn-compact:active {
  transform: translateY(0);
}

.timer-start-layout {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 16px;
}
</style>

<script>
  mixpanel.track("Page Viewed", { page: "practice" });
</script>