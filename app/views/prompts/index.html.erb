<% content_for :title, "Practice Prompts" %>

<div class="prompts-index" data-controller="prompts">
  <div class="page-header">
    <h1>Practice Prompts</h1>
    <p>Choose from our library of speaking scenarios to improve your communication skills</p>
  </div>

  <% if @adaptive_prompts.any? %>
    <div class="adaptive-prompts-section">
      <div class="section-header">
        <div class="section-icon">üéØ</div>
        <div class="section-content">
          <h2>Recommended for You</h2>
          <p class="section-description">
            Based on your recent sessions, these prompts will help you work on:
            <% @user_weaknesses.each_with_index do |weakness, index| %>
              <span class="weakness-tag"><%= weakness.humanize %></span><%= ', ' unless index == @user_weaknesses.length - 1 %>
            <% end %>
          </p>
        </div>
      </div>
      
      <div class="adaptive-prompts-grid">
        <% @adaptive_prompts.each do |category, prompts| %>
          <% prompts.first(2).each_with_index do |prompt, index| %>
            <div class="prompt-card adaptive-prompt"
                 data-category="recommended"
                 data-prompts-target="card"
                 data-prompt-id="adaptive_<%= category %>_<%= index %>">

              <div class="prompt-header">
                <!-- Title and Badges Row -->
                <div class="prompt-title-row">
                  <h3 class="prompt-title-practice"><%= prompt['title'] %></h3>
                  <div class="prompt-badges-practice">
                    <span class="prompt-category improvement-tag">
                      <%= category.humanize %>
                    </span>
                    <% if prompt['difficulty'] %>
                      <span class="difficulty-badge difficulty-<%= prompt['difficulty'].downcase %>">
                        <%= prompt['difficulty'].capitalize %>
                      </span>
                    <% end %>
                  </div>
                </div>

                <!-- Description -->
                <p class="prompt-description-practice"><%= prompt['description'] %></p>
              </div>

              <!-- Full Prompt Text -->
              <div class="prompt-text-practice">
                <%= prompt['prompt'] %>
              </div>

              <!-- Footer -->
              <div class="prompt-footer-practice">
                <div class="prompt-footer-left">
                  <span class="duration-icon">‚è±</span>
                  <span class="duration-text"><%= distance_of_time_in_words(prompt['target_seconds']) %></span>
                </div>

                <div class="prompt-footer-right">
                  <%= link_to practice_path(adaptive_prompt: true, category: category, index: index),
                        class: "btn btn-primary practice-btn" do %>
                    Practice <span class="chevron">‚Ä∫</span>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>


  <div class="prompts-controls">
    <div class="search-filter">
      <input type="search"
             placeholder="Search prompts..."
             class="search-input"
             data-prompts-target="searchInput"
             data-action="input->prompts#filterPrompts">
    </div>

    <div class="filter-dropdowns">
      <div class="filter-dropdown-group">
        <label for="difficulty-filter">Difficulty</label>
        <select multiple
                id="difficulty-filter"
                class="filter-select"
                data-prompts-target="difficultyFilter"
                data-action="change->prompts#applyFilters">
          <option value="beginner">Beginner</option>
          <option value="intermediate">Intermediate</option>
          <option value="advanced">Advanced</option>
        </select>
      </div>

      <div class="filter-dropdown-group">
        <label for="duration-filter">Duration</label>
        <select multiple
                id="duration-filter"
                class="filter-select"
                data-prompts-target="durationFilter"
                data-action="change->prompts#applyFilters">
          <option value="quick">Quick (‚â§45s)</option>
          <option value="standard">Standard (46-75s)</option>
          <option value="deep">Deep Dive (>75s)</option>
        </select>
      </div>

      <div class="filter-dropdown-group">
        <label for="category-filter">Category</label>
        <select multiple
                id="category-filter"
                class="filter-select"
                data-prompts-target="categoryFilter"
                data-action="change->prompts#applyFilters">
          <% @categories.reject { |c| c == "recommended" }.each do |category| %>
            <option value="<%= category %>"><%= category.humanize %></option>
          <% end %>
        </select>
      </div>

      <div class="filter-dropdown-group">
        <label for="focus-filter">Focus Areas</label>
        <select multiple
                id="focus-filter"
                class="filter-select"
                data-prompts-target="focusFilter"
                data-action="change->prompts#applyFilters">
          <option value="clarity">Clarity</option>
          <option value="engagement">Engagement</option>
          <option value="pacing">Pacing</option>
          <option value="confidence">Confidence</option>
          <option value="tone">Tone</option>
          <option value="control">Control</option>
          <option value="energy">Energy</option>
          <option value="structure">Structure</option>
          <option value="articulation">Articulation</option>
          <option value="persuasion">Persuasion</option>
        </select>
      </div>
    </div>

    <div class="view-options">
      <button type="button"
              class="btn btn-secondary"
              data-action="click->prompts#toggleFavorites">
        ‚≠ê Favorites
      </button>
      <button type="button"
              class="btn btn-secondary"
              data-action="click->prompts#clearFilters">
        Clear Filters
      </button>
    </div>
  </div>

  <div class="prompts-library-section">
    <h2 class="library-title">Browse All Prompts</h2>
  </div>

  <div class="prompts-grid" data-prompts-target="grid">
    <% @prompts.each_with_index do |(category, category_prompts), cat_index| %>
      <% next if %w[filler_words pace_issues clarity_issues confidence_issues engagement_issues].include?(category) %>

      <div class="category-section" data-category="<%= category %>">
        <div class="category-header">
          <h3 class="category-title">
            <%= category.humanize %>
            <span class="category-count">(<%= category_prompts.size %>)</span>
          </h3>
          <% if category_prompts.size > 6 %>
            <button type="button"
                    class="btn-category-toggle"
                    data-action="click->prompts#toggleCategoryExpansion"
                    data-category="<%= category %>">
              <span class="toggle-text">Show all</span>
              <span class="toggle-icon">‚ñº</span>
            </button>
          <% end %>
        </div>

        <div class="category-prompts-grid">
          <% category_prompts.each_with_index do |prompt, index| %>
            <div class="prompt-card"
                 data-category="<%= category %>"
                 data-prompts-target="card"
                 data-prompt-id="<%= "#{category}_#{index}" %>"
                 data-prompt-index="<%= index %>"
                 data-category-item="<%= category %>"
                 data-difficulty="<%= prompt['difficulty'] %>"
                 data-duration="<%= prompt['target_seconds'].to_i <= 45 ? 'quick' : (prompt['target_seconds'].to_i.between?(46, 75) ? 'standard' : 'deep') %>"
                 data-focus-areas="<%= (prompt['focus_areas'] || prompt['skills'] || []).join(',') %>"
                 style="<%= 'display: none;' if index >= 6 %>">

              <div class="prompt-header">
                <!-- Title and Badges Row -->
                <div class="prompt-title-row">
                  <h3 class="prompt-title-practice"><%= prompt['title'] %></h3>
                  <div class="prompt-badges-practice">
                    <span class="prompt-category">
                      <%= category.humanize %>
                    </span>
                    <% if prompt['difficulty'] %>
                      <span class="difficulty-badge difficulty-<%= prompt['difficulty'].downcase %>">
                        <%= prompt['difficulty'].capitalize %>
                      </span>
                    <% end %>
                  </div>
                </div>

                <!-- Description -->
                <p class="prompt-description-practice"><%= prompt['description'] %></p>
              </div>

              <!-- Full Prompt Text -->
              <div class="prompt-text-practice">
                <%= prompt['prompt'] %>
              </div>

              <!-- Footer -->
              <div class="prompt-footer-practice">
                <div class="prompt-footer-left">
                  <span class="duration-icon">‚è±</span>
                  <span class="duration-text"><%= distance_of_time_in_words(prompt['target_seconds']) %></span>
                </div>

                <div class="prompt-footer-right">
                  <%= link_to practice_path(prompt_id: "#{category}_#{index}"),
                        class: "btn btn-primary practice-btn" do %>
                    Practice <span class="chevron">‚Ä∫</span>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Empty States -->
  <div class="empty-state" data-prompts-target="noResults" style="display: none;">
    <div class="empty-icon">üîç</div>
    <h3>No prompts found</h3>
    <p>Try adjusting your search or filter criteria.</p>
    <button type="button" class="btn btn-secondary" data-action="click->prompts#clearFilters">
      Clear All Filters
    </button>
  </div>

  <div class="empty-state" data-prompts-target="noFavorites" style="display: none;">
    <div class="empty-icon">‚≠ê</div>
    <h3>No favorites yet</h3>
    <p>Mark prompts as favorites using the ‚òÜ button to see them here.</p>
    <button type="button" class="btn btn-secondary" data-action="click->prompts#toggleFavorites">
      Show All Prompts
    </button>
  </div>

  <!-- Quick Practice Section - Simplified -->
  <div class="quick-practice-section">
    <h2>üöÄ Quick Start</h2>
    <div class="quick-options-grid">
      <div class="quick-option">
        <h4>Random Challenge</h4>
        <p>Get a random prompt from any category</p>
        <button type="button" class="btn btn-outline" data-action="click->prompts#startRandomPractice">
          Try Random Prompt
        </button>
      </div>

      <div class="quick-option">
        <h4>Daily Practice</h4>
        <p>Today's recommended prompt based on your history</p>
        <button type="button" class="btn btn-outline" data-action="click->prompts#startDailyPractice">
          Today's Prompt
        </button>
      </div>
    </div>
  </div>

  <!-- Tips Section - Simplified -->
  <div class="prompts-tips">
    <h3>üí° Quick Tips</h3>
    <div class="tips-grid">
      <div class="tip-item">
        <div class="tip-icon">üìù</div>
        <div class="tip-content">
          <h4>Prepare First</h4>
          <p>Read the prompt and organize your thoughts before recording.</p>
        </div>
      </div>
      
      <div class="tip-item">
        <div class="tip-icon">üéØ</div>
        <div class="tip-content">
          <h4>Stay Focused</h4>
          <p>Address the specific scenario in the prompt.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Preview Modal (hidden by default) -->
<div class="modal-overlay" data-prompts-target="modalOverlay" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3 data-prompts-target="modalTitle">Prompt Preview</h3>
      <button type="button" class="modal-close" data-action="click->prompts#closeModal">√ó</button>
    </div>
    
    <div class="modal-body" data-prompts-target="modalBody">
      <!-- Dynamic content loaded here -->
    </div>
    
    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" data-action="click->prompts#closeModal">
        Close
      </button>
      <button type="button" class="btn btn-primary" data-prompts-target="modalPracticeBtn">
        üé§ Practice This Prompt
      </button>
    </div>
  </div>
</div>