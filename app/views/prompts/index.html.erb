<% content_for :title, "Practice Prompts" %>

<div class="prompts-index" data-controller="prompts">
  <div class="page-header">
    <h1>Practice Prompts</h1>
    <p>Choose from our library of speaking scenarios to improve your communication skills</p>
  </div>

  <% if @adaptive_prompts.any? %>
    <div class="adaptive-prompts-section">
      <div class="section-header">
        <div class="section-icon">üéØ</div>
        <div class="section-content">
          <h2>Recommended for You</h2>
          <p class="section-description">
            Based on your recent sessions, these prompts will help you work on:
            <% @user_weaknesses.each_with_index do |weakness, index| %>
              <span class="weakness-tag"><%= weakness.humanize %></span><%= ', ' unless index == @user_weaknesses.length - 1 %>
            <% end %>
          </p>
        </div>
      </div>
      
      <div class="adaptive-prompts-grid">
        <% @adaptive_prompts.each do |category, prompts| %>
          <% prompts.first(2).each_with_index do |prompt, index| %>
            <div class="prompt-card adaptive-prompt"
                 data-category="recommended"
                 data-prompts-target="card"
                 data-prompt-id="adaptive_<%= category %>_<%= index %>">

              <div class="prompt-header">
                <div class="prompt-header-top">
                  <span class="prompt-category improvement-tag">
                    <%= category.humanize %>
                  </span>
                  <h3 class="prompt-title"><%= prompt['title'] %></h3>
                </div>
                <p class="prompt-description"><%= prompt['description'] %></p>
              </div>

              <div class="prompt-content">
                <div class="prompt-text">
                  <p><%= prompt['prompt'] %></p>
                </div>
              </div>

              <div class="prompt-footer">
                <div class="prompt-footer-left">
                  <span class="duration-icon">‚è±</span>
                  <span class="duration-text"><%= distance_of_time_in_words(prompt['target_seconds']) %></span>
                </div>

                <div class="prompt-footer-center">
                  <% if prompt['focus_areas'] && prompt['focus_areas'].any? %>
                    <span class="focus-label">Focus: </span>
                    <span class="focus-areas">
                      <%= prompt['focus_areas'].first(3).join(', ') %><%= prompt['focus_areas'].length > 3 ? '...' : '' %>
                    </span>
                  <% end %>
                </div>

                <div class="prompt-footer-right">
                  <%= link_to practice_path(adaptive_prompt: true, category: category, index: index),
                        class: "btn btn-primary practice-btn" do %>
                    Practice <span class="chevron">‚Ä∫</span>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <div class="prompts-controls">
    <div class="search-filter">
      <input type="search" 
             placeholder="Search prompts..." 
             class="search-input"
             data-prompts-target="searchInput"
             data-action="input->prompts#filterPrompts">
    </div>

    <div class="category-filters">
      <button type="button" 
              class="filter-btn active" 
              data-action="click->prompts#filterCategory"
              data-category="all"
              data-prompts-target="filterBtn">
        All Categories
      </button>
      <% @categories.each do |category| %>
        <button type="button" 
                class="filter-btn"
                data-action="click->prompts#filterCategory"
                data-category="<%= category %>"
                data-prompts-target="filterBtn">
          <%= category.humanize %>
        </button>
      <% end %>
    </div>

    <div class="view-options">
      <button type="button" 
              class="btn btn-secondary"
              data-action="click->prompts#shuffleRandom">
        üé≤ Random Prompt
      </button>
      <button type="button"
              class="btn btn-secondary" 
              data-action="click->prompts#toggleFavorites">
        ‚≠ê Favorites Only
      </button>
    </div>
  </div>

  <div class="prompts-grid" data-prompts-target="grid">
    <% @prompts.each_with_index do |(category, category_prompts), cat_index| %>
      <% category_prompts.each_with_index do |prompt, index| %>
        <div class="prompt-card"
             data-category="<%= category %>"
             data-prompts-target="card"
             data-prompt-id="<%= "#{category}_#{index}" %>"
             data-prompt-index="<%= index %>"
             style="<%= 'display: none;' if index >= 6 %>">

          <div class="prompt-header">
            <div class="prompt-header-top">
              <span class="prompt-category">
                <%= category.humanize %>
              </span>
              <h3 class="prompt-title"><%= prompt['title'] %></h3>
            </div>
            <p class="prompt-description"><%= prompt['description'] %></p>
          </div>

          <div class="prompt-content">
            <div class="prompt-text">
              <p><%= prompt['prompt'] %></p>
            </div>
          </div>

          <div class="prompt-footer">
            <div class="prompt-footer-left">
              <span class="duration-icon">‚è±</span>
              <span class="duration-text"><%= distance_of_time_in_words(prompt['target_seconds']) %></span>
            </div>

            <div class="prompt-footer-center">
              <% if prompt['skills'] && prompt['skills'].any? %>
                <span class="focus-label">Focus: </span>
                <span class="focus-areas">
                  <%= prompt['skills'].first(3).join(', ') %><%= prompt['skills'].length > 3 ? '...' : '' %>
                </span>
              <% end %>
            </div>

            <div class="prompt-footer-right">
              <%= link_to practice_path(prompt_id: "#{category}_#{index}"),
                    class: "btn btn-primary practice-btn" do %>
                Practice <span class="chevron">‚Ä∫</span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <% if category_prompts.length > 6 %>
        <div class="show-more-container" data-category="<%= category %>" data-prompts-target="showMoreBtn">
          <button type="button"
                  class="btn btn-secondary"
                  data-action="click->prompts#showMore"
                  data-category="<%= category %>">
            Show More (<%= category_prompts.length - 6 %> more)
          </button>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Empty States -->
  <div class="empty-state" data-prompts-target="noResults" style="display: none;">
    <div class="empty-icon">üîç</div>
    <h3>No prompts found</h3>
    <p>Try adjusting your search or filter criteria.</p>
    <button type="button" class="btn btn-secondary" data-action="click->prompts#clearFilters">
      Clear All Filters
    </button>
  </div>

  <div class="empty-state" data-prompts-target="noFavorites" style="display: none;">
    <div class="empty-icon">‚≠ê</div>
    <h3>No favorites yet</h3>
    <p>Mark prompts as favorites using the ‚òÜ button to see them here.</p>
    <button type="button" class="btn btn-secondary" data-action="click->prompts#toggleFavorites">
      Show All Prompts
    </button>
  </div>

  <!-- Quick Practice Section - Simplified -->
  <div class="quick-practice-section">
    <h2>üöÄ Quick Start</h2>
    <div class="quick-options-grid">
      <div class="quick-option">
        <h4>Random Challenge</h4>
        <p>Get a random prompt from any category</p>
        <button type="button" class="btn btn-outline" data-action="click->prompts#startRandomPractice">
          Try Random Prompt
        </button>
      </div>

      <div class="quick-option">
        <h4>Daily Practice</h4>
        <p>Today's recommended prompt based on your history</p>
        <button type="button" class="btn btn-outline" data-action="click->prompts#startDailyPractice">
          Today's Prompt
        </button>
      </div>
    </div>
  </div>

  <!-- Tips Section - Simplified -->
  <div class="prompts-tips">
    <h3>üí° Quick Tips</h3>
    <div class="tips-grid">
      <div class="tip-item">
        <div class="tip-icon">üìù</div>
        <div class="tip-content">
          <h4>Prepare First</h4>
          <p>Read the prompt and organize your thoughts before recording.</p>
        </div>
      </div>
      
      <div class="tip-item">
        <div class="tip-icon">üéØ</div>
        <div class="tip-content">
          <h4>Stay Focused</h4>
          <p>Address the specific scenario in the prompt.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Preview Modal (hidden by default) -->
<div class="modal-overlay" data-prompts-target="modalOverlay" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3 data-prompts-target="modalTitle">Prompt Preview</h3>
      <button type="button" class="modal-close" data-action="click->prompts#closeModal">√ó</button>
    </div>
    
    <div class="modal-body" data-prompts-target="modalBody">
      <!-- Dynamic content loaded here -->
    </div>
    
    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" data-action="click->prompts#closeModal">
        Close
      </button>
      <button type="button" class="btn btn-primary" data-prompts-target="modalPracticeBtn">
        üé§ Practice This Prompt
      </button>
    </div>
  </div>
</div>