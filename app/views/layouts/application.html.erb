<!DOCTYPE html>
<html lang="en">
  <head>
    <title><%= content_for(:title) || "AI Talk Coach" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="AI-powered speech coaching platform to improve your communication skills">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KM66Q2D5T3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-KM66Q2D5T3');
    </script>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body data-controller="accessibility analytics" data-analytics-enabled-value="<%= Rails.env.production? %>" data-analytics-debug-value="<%= !Rails.env.production? %>">
    <!-- Skip to main content link for keyboard users -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Accessibility settings panel -->
    <div class="accessibility-panel" data-accessibility-target="panel" aria-hidden="true">
      <h2>Accessibility Settings</h2>
      <div class="accessibility-controls">
        <button type="button" 
                class="accessibility-btn"
                data-action="click->accessibility#toggleHighContrast"
                aria-pressed="false">
          Toggle High Contrast
        </button>
        <button type="button" 
                class="accessibility-btn"
                data-action="click->accessibility#toggleLargeText"
                aria-pressed="false">
          Toggle Large Text
        </button>
        <button type="button" 
                class="accessibility-btn"
                data-action="click->accessibility#toggleReducedMotion"
                aria-pressed="false">
          Reduce Motion
        </button>
        <button type="button" 
                class="accessibility-btn"
                data-action="click->accessibility#toggleKeyboardNavigation"
                aria-pressed="false">
          Enhanced Keyboard Navigation
        </button>
      </div>
      <button type="button" 
              class="close-panel"
              data-action="click->accessibility#closePanel"
              aria-label="Close accessibility panel">
        ‚úï
      </button>
    </div>
    
    <!-- Accessibility toggle button -->
    <button type="button" 
            class="accessibility-toggle"
            data-action="click->accessibility#togglePanel"
            aria-label="Open accessibility settings"
            title="Accessibility Settings">
      ‚ôø
    </button>
    
    <header class="main-header" role="banner">
      <nav class="main-nav"
           data-controller="navigation"
           role="navigation"
           aria-label="Main navigation">
        <div class="logo-container">
          <%= link_to root_path,
                class: "logo-link",
                "aria-label" => "AI Talk Coach - Go to homepage" do %>
            <img src="/logo.png" alt="AI Talk Coach" class="logo-image" />
            <span class="logo-text">AI Talk Coach</span>
          <% end %>
        </div>
        
        <!-- Mobile Menu Toggle -->
        <button type="button" 
                class="mobile-menu-toggle" 
                aria-label="Toggle navigation menu"
                aria-expanded="false"
                aria-controls="nav-menu"
                data-action="click->navigation#toggleMenu"
                data-navigation-target="toggleButton">
          <span class="hamburger-line" aria-hidden="true"></span>
          <span class="hamburger-line" aria-hidden="true"></span>
          <span class="hamburger-line" aria-hidden="true"></span>
        </button>

        <!-- Navigation Links -->
        <div class="nav-menu" id="nav-menu" data-navigation-target="menu">
          <ul class="nav-links" role="menubar">
            <% if logged_in? %>
              <li class="nav-item" role="none">
                <%= link_to practice_path,
                      class: "nav-link #{'active' if current_page?(practice_path)}",
                      role: "menuitem",
                      "aria-current": (current_page?(practice_path) ? "page" : nil),
                      data: { action: "click->navigation#closeMenu" } do %>
                  <span class="nav-icon" aria-hidden="true">üé§</span>
                  <span class="nav-text">Practice</span>
                <% end %>
              </li>
            <% end %>
            <% if logged_in? %>
              <li class="nav-item" role="none">
                <%= link_to history_sessions_path,
                      class: "nav-link #{'active' if current_page?(history_sessions_path)}",
                      role: "menuitem",
                      "aria-current": (current_page?(history_sessions_path) ? "page" : nil),
                      data: { action: "click->navigation#closeMenu" } do %>
                  <span class="nav-icon" aria-hidden="true">üìä</span>
                  <span class="nav-text">History</span>
                <% end %>
              </li>
            <% end %>
            <li class="nav-item" role="none">
              <%= link_to prompts_path, 
                    class: "nav-link #{'active' if current_page?(prompts_path)}",
                    role: "menuitem",
                    "aria-current": (current_page?(prompts_path) ? "page" : nil),
                    data: { action: "click->navigation#closeMenu" } do %>
                <span class="nav-icon" aria-hidden="true">üí°</span>
                <span class="nav-text">Prompts</span>
              <% end %>
            </li>
            <li class="nav-item" role="none">
              <%= link_to privacy_settings_path,
                    class: "nav-link #{'active' if current_page?(privacy_settings_path)}",
                    role: "menuitem",
                    "aria-current": (current_page?(privacy_settings_path) ? "page" : nil),
                    data: { action: "click->navigation#closeMenu" } do %>
                <span class="nav-icon" aria-hidden="true">üîê</span>
                <span class="nav-text">Privacy</span>
              <% end %>
            </li>

            <!-- Authentication Links -->
            <% if logged_in? %>
              <li class="nav-item nav-user" role="none">
                <span class="nav-link user-info">
                  <span class="nav-icon" aria-hidden="true">üë§</span>
                  <span class="nav-text"><%= current_user.name %></span>
                </span>
              </li>
              <li class="nav-item" role="none">
                <%= link_to logout_path,
                      class: "nav-link logout-link",
                      role: "menuitem",
                      data: {
                        action: "click->navigation#closeMenu"
                      },
                      "data-logout-link" => true do %>
                  <span class="nav-icon" aria-hidden="true">üö™</span>
                  <span class="nav-text">Logout</span>
                <% end %>
              </li>
            <% else %>
              <li class="nav-item" role="none">
                <%= link_to login_path,
                      class: "nav-link #{'active' if current_page?(login_path)}",
                      role: "menuitem",
                      "aria-current": (current_page?(login_path) ? "page" : nil),
                      data: { action: "click->navigation#closeMenu" } do %>
                  <span class="nav-icon" aria-hidden="true">üîë</span>
                  <span class="nav-text">Login</span>
                <% end %>
              </li>
              <li class="nav-item" role="none">
                <%= link_to signup_path,
                      class: "nav-link signup-link #{'active' if current_page?(signup_path)}",
                      role: "menuitem",
                      "aria-current": (current_page?(signup_path) ? "page" : nil),
                      data: { action: "click->navigation#closeMenu" } do %>
                  <span class="nav-icon" aria-hidden="true">‚ú®</span>
                  <span class="nav-text">Sign Up</span>
                <% end %>
              </li>
            <% end %>
          </ul>
        </div>
      </nav>
    </header>
    
    <% if notice %>
      <div class="flash notice" role="alert" aria-live="polite">
        <span aria-hidden="true">‚úì</span> <%= notice %>
      </div>
    <% end %>
    
    <% if alert %>
      <div class="flash alert" role="alert" aria-live="assertive">
        <span aria-hidden="true">‚ö†Ô∏è</span> <%= alert %>
      </div>
    <% end %>
    
    <main class="main-content" id="main-content" role="main" tabindex="-1">
      <%= yield %>
    </main>
  </body>
</html>
